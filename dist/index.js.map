{"version":3,"file":"index.js","sources":["../node_modules/style-inject/dist/style-inject.es.js","../src/Shape.ts","../src/Transformer.ts","../src/utils/randomId.ts","../src/annotation/CreatingAnnotationState.ts","../src/annotation/DraggingAnnotationState.ts","../src/annotation/TransfromationState.ts","../src/annotation/DefaultAnnotationState.ts","../src/DeleteButton.tsx","../src/DefaultInputSection.tsx","../src/ReactPictureAnnotation.tsx"],"sourcesContent":["function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","import { IAnnotation } from \"./Annotation\";\n\nexport const shapeStyle = {\n  padding: 5,\n  margin: 10,\n  fontSize: 12,\n  fontColor: \"#212529\",\n  fontBackground: \"#f8f9fa\",\n  fontFamily:\n    \"-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, 'Helvetica Neue', Helvetica, Arial, sans-serif\",\n  shapeBackground: \"hsla(210, 16%, 93%, 0.2)\",\n  shapeStrokeStyle: \"ff0000\",\n  shapeShadowStyle: \"hsla(210, 9%, 31%, 0.35)\"\n};\n\nexport interface IShapeBase {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n  shadowColor?: string;\n  backgroundColor?: string;\n  strokeColor?: string;\n}\n\nexport interface IShapeAdjustBase extends Partial<IShapeBase> {}\n\nexport interface IShapeData extends IShapeBase {\n  type: string;\n}\n\nexport interface IRectShapeData extends IShapeData {\n  type: \"RECT\";\n}\n\nexport interface IShape {\n  onDragStart: (positionX: number, positionY: number) => void;\n  onDrag: (positionX: number, positionY: number) => void;\n  checkBoundary: (positionX: number, positionY: number) => boolean;\n  paint: (\n    canvas2D: CanvasRenderingContext2D,\n    calculateTruePosition: (shapeData: IShapeBase) => IShapeBase,\n    selected: boolean,\n    drawLabel: boolean\n  ) => IShapeBase;\n  getAnnotationData: () => IAnnotation;\n  adjustMark: (adjustBase: IShapeAdjustBase) => void;\n  setComment: (comment: string) => void;\n  equal: (data: IAnnotation) => boolean;\n}\n\nexport class RectShape implements IShape {\n  private annotationData: IAnnotation<IShapeData>;\n\n  private onChangeCallBack: () => void;\n\n  private dragStartOffset: { offsetX: number; offsetY: number };\n\n  constructor(data: IAnnotation<IShapeData>, onChange: () => void) {\n    this.annotationData = data;\n    this.onChangeCallBack = onChange;\n  }\n\n  public onDragStart = (positionX: number, positionY: number) => {\n    const { x, y } = this.annotationData.mark;\n    this.dragStartOffset = {\n      offsetX: positionX - x,\n      offsetY: positionY - y\n    };\n  };\n\n  public onDrag = (positionX: number, positionY: number) => {\n    this.annotationData.mark.x = positionX - this.dragStartOffset.offsetX;\n    this.annotationData.mark.y = positionY - this.dragStartOffset.offsetY;\n    this.onChangeCallBack();\n  };\n\n  public checkBoundary = (positionX: number, positionY: number) => {\n    const {\n      mark: { x, y, width, height }\n    } = this.annotationData;\n\n    if (\n      ((positionX > x && positionX < x + width) ||\n        (positionX < x && positionX > x + width)) &&\n      ((positionY > y && positionY < y + height) ||\n        (positionY < y && positionY > y + height))\n    ) {\n      return true;\n    }\n    return false;\n  };\n\n  public paint = (\n    canvas2D: CanvasRenderingContext2D,\n    calculateTruePosition: (shapeData: IShapeBase) => IShapeBase,\n    selected: boolean,\n    drawLabel: boolean\n  ) => {\n    const { mark } = this.annotationData;\n    const { x, y, width, height } = calculateTruePosition(mark);\n    canvas2D.save();\n\n    canvas2D.shadowBlur = 10;\n    canvas2D.shadowColor = mark.shadowColor || shapeStyle.shapeShadowStyle;\n    canvas2D.strokeStyle = mark.strokeColor || shapeStyle.shapeStrokeStyle;\n    canvas2D.lineWidth = 2;\n    canvas2D.strokeRect(x, y, width, height);\n    canvas2D.restore();\n    if (selected) {\n      canvas2D.fillStyle = mark.backgroundColor || shapeStyle.shapeBackground;\n      canvas2D.fillRect(x, y, width, height);\n    } else {\n      const { comment } = this.annotationData;\n      if (comment && drawLabel) {\n        canvas2D.font = `${shapeStyle.fontSize}px ${shapeStyle.fontFamily}`;\n        const metrics = canvas2D.measureText(comment);\n        canvas2D.save();\n        canvas2D.fillStyle = shapeStyle.fontBackground;\n        canvas2D.fillRect(\n          x,\n          y,\n          metrics.width + shapeStyle.padding * 2,\n          shapeStyle.fontSize + shapeStyle.padding * 2\n        );\n        canvas2D.textBaseline = \"top\";\n        canvas2D.fillStyle = shapeStyle.fontColor;\n        canvas2D.fillText(\n          comment,\n          x + shapeStyle.padding,\n          y + shapeStyle.padding\n        );\n      }\n    }\n    canvas2D.restore();\n\n    return { x, y, width, height };\n  };\n\n  public adjustMark = ({\n    x = this.annotationData.mark.x,\n    y = this.annotationData.mark.y,\n    width = this.annotationData.mark.width,\n    height = this.annotationData.mark.height\n  }: {\n    x?: number;\n    y?: number;\n    width?: number;\n    height?: number;\n  }) => {\n    this.annotationData.mark.x = x;\n    this.annotationData.mark.y = y;\n    this.annotationData.mark.width = width;\n    this.annotationData.mark.height = height;\n    this.onChangeCallBack();\n  };\n\n  public getAnnotationData = () => {\n    return this.annotationData;\n  };\n\n  public setComment = (comment: string) => {\n    this.annotationData.comment = comment;\n  };\n\n  public equal = (data: IAnnotation) => {\n    return (\n      data.id === this.annotationData.id &&\n      data.comment === this.annotationData.comment &&\n      data.mark.x === this.annotationData.mark.x &&\n      data.mark.y === this.annotationData.mark.y &&\n      data.mark.width === this.annotationData.mark.width &&\n      data.mark.height === this.annotationData.mark.height\n    );\n  };\n}\n","import { IShape, IShapeBase } from \"Shape\";\n\nconst NODE_WIDTH = 10;\n\nexport interface ITransformer {\n  id: string;\n  checkBoundary: (positionX: number, positionY: number) => boolean;\n  startTransformation: (positionX: number, positionY: number) => void;\n  onTransformation: (positionX: number, positionY: number) => void;\n  paint: (\n    canvas2D: CanvasRenderingContext2D,\n    calculateTruePosition: (shapeData: IShapeBase) => IShapeBase\n  ) => void;\n}\n\nexport default class Transformer implements ITransformer {\n  public id: string;\n  private shape: IShape;\n  private editable: boolean;\n  private currentNodeCenterIndex: number;\n\n  constructor(shape: IShape, editable: boolean) {\n    this.shape = shape;\n    this.editable = editable;\n    this.id = shape.getAnnotationData().id;\n  }\n  public checkBoundary = (positionX: number, positionY: number) => {\n    const currentCenterIndex = this.getCenterIndexByCursor(\n      positionX,\n      positionY\n    );\n    return currentCenterIndex >= 0;\n  };\n\n  public startTransformation = (positionX: number, positionY: number) => {\n    const currentCenterIndex = this.getCenterIndexByCursor(\n      positionX,\n      positionY\n    );\n    this.currentNodeCenterIndex = currentCenterIndex;\n  };\n\n  public onTransformation = (positionX: number, positionY: number) => {\n    const currentCentersTable = this.getAllCentersTable();\n    currentCentersTable[this.currentNodeCenterIndex].adjust(\n      positionX,\n      positionY\n    );\n  };\n\n  public paint = (\n    canvas2D: CanvasRenderingContext2D,\n    calculateTruePosition: (shapeData: IShapeBase) => IShapeBase\n  ) => {\n    const allCentersTable = this.getAllCentersTable();\n    canvas2D.save();\n    canvas2D.fillStyle = \"#5c7cfa\";\n    if (this.editable) {\n      for (const item of allCentersTable) {\n        const { x, y, width, height } = calculateTruePosition({\n          x: item.x - NODE_WIDTH / 2,\n          y: item.y - NODE_WIDTH / 2,\n          width: NODE_WIDTH,\n          height: NODE_WIDTH\n        });\n        canvas2D.fillRect(x, y, width, height);\n      }\n    }\n\n    canvas2D.restore();\n  };\n\n  private getCenterIndexByCursor = (positionX: number, positionY: number) => {\n    const allCentersTable = this.getAllCentersTable();\n    return allCentersTable.findIndex(item =>\n      this.checkEachRectBoundary(item.x, item.y, positionX, positionY)\n    );\n  };\n\n  private checkEachRectBoundary = (\n    rectCenterX: number,\n    rectCenterY: number,\n    positionX: number,\n    positionY: number\n  ) => {\n    if (\n      Math.abs(positionX - rectCenterX) <= NODE_WIDTH / 2 &&\n      Math.abs(positionY - rectCenterY) <= NODE_WIDTH / 2\n    ) {\n      return true;\n    }\n    return false;\n  };\n\n  private getAllCentersTable = () => {\n    const { shape } = this;\n    const { x, y, width, height } = shape.getAnnotationData().mark;\n    return [\n      {\n        x,\n        y,\n        adjust: (positionX: number, positionY: number) => {\n          shape.adjustMark({\n            x: positionX,\n            y: positionY,\n            width: width + x - positionX,\n            height: height + y - positionY\n          });\n        }\n      },\n      {\n        x: x + width / 2,\n        y,\n        adjust: (_: number, positionY: number) => {\n          shape.adjustMark({\n            y: positionY,\n            height: height + y - positionY\n          });\n        }\n      },\n      {\n        x: x + width,\n        y,\n        adjust: (positionX: number, positionY: number) => {\n          shape.adjustMark({\n            x,\n            y: positionY,\n            width: positionX - x,\n            height: y + height - positionY\n          });\n        }\n      },\n      {\n        x,\n        y: y + height / 2,\n        adjust: (positionX: number) => {\n          shape.adjustMark({\n            x: positionX,\n            width: width + x - positionX\n          });\n        }\n      },\n      {\n        x: x + width,\n        y: y + height / 2,\n        adjust: (positionX: number) => {\n          shape.adjustMark({ width: positionX - x });\n        }\n      },\n      {\n        x,\n        y: y + height,\n        adjust: (positionX: number, positionY: number) => {\n          shape.adjustMark({\n            x: positionX,\n            width: width + x - positionX,\n            height: positionY - y\n          });\n        }\n      },\n      {\n        x: x + width / 2,\n        y: y + height,\n        adjust: (_: number, positionY: number) => {\n          shape.adjustMark({\n            height: positionY - y\n          });\n        }\n      },\n      {\n        x: x + width,\n        y: y + height,\n        adjust: (positionX: number, positionY: number) => {\n          shape.adjustMark({\n            width: positionX - x,\n            height: positionY - y\n          });\n        }\n      }\n    ];\n  };\n}\n","export default (len = 6) => {\n  const chars = \"ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678\";\n  const maxPos = chars.length;\n  let id = \"\";\n  for (let i = 0; i < len; i++) {\n    id += chars.charAt(Math.floor(Math.random() * maxPos));\n  }\n  return id;\n};\n","import { ReactPictureAnnotation } from \"index\";\nimport { IAnnotationState } from \"./AnnotationState\";\nimport { DefaultAnnotationState } from \"./DefaultAnnotationState\";\n\nexport default class CreatingAnnotationState implements IAnnotationState {\n  private context: ReactPictureAnnotation;\n  constructor(context: ReactPictureAnnotation) {\n    this.context = context;\n  }\n  public onMouseDown = () => undefined;\n  public onMouseMove = (positionX: number, positionY: number) => {\n    const { shapes, onShapeChange } = this.context;\n    if (shapes.length > 0) {\n      const currentShape = shapes.find(\n        el => el.getAnnotationData().id === this.context.pendingShapeId\n      );\n      if (currentShape) {\n        const {\n          mark: { x, y }\n        } = currentShape.getAnnotationData();\n        currentShape.adjustMark({\n          width: positionX - x,\n          height: positionY - y\n        });\n      }\n    }\n    onShapeChange();\n  };\n\n  public onMouseUp = () => {\n    const {\n      shapes,\n      onShapeChange,\n      setAnnotationState,\n      onDelete,\n      props: { onAnnotationCreate }\n    } = this.context;\n    const data = shapes.find(\n      el => el.getAnnotationData().id === this.context.pendingShapeId\n    );\n    if (data) {\n      if (\n        data &&\n        data.getAnnotationData().mark.width !== 0 &&\n        data.getAnnotationData().mark.height !== 0\n      ) {\n        this.context.selectedId = data.getAnnotationData().id;\n        if (onAnnotationCreate) {\n          onAnnotationCreate(data.getAnnotationData());\n        }\n      } else {\n        onDelete(this.context.pendingShapeId);\n        this.context.selectedId = null;\n      }\n    } else {\n      this.context.pendingShapeId = null;\n      this.context.selectedId = null;\n    }\n    setAnnotationState(new DefaultAnnotationState(this.context));\n    onShapeChange();\n  };\n\n  public onMouseLeave = () => this.onMouseUp();\n}\n","import { ReactPictureAnnotation } from \"index\";\nimport { IAnnotationState } from \"./AnnotationState\";\nimport { DefaultAnnotationState } from \"./DefaultAnnotationState\";\n\nexport default class DraggingAnnotationState implements IAnnotationState {\n  private context: ReactPictureAnnotation;\n  constructor(context: ReactPictureAnnotation) {\n    this.context = context;\n  }\n  public onMouseDown = () => undefined;\n  public onMouseMove = (positionX: number, positionY: number) => {\n    const { shapes, selectedId } = this.context;\n    const currentShape = shapes.find(\n      el => el.getAnnotationData().id === selectedId\n    );\n    currentShape!.onDrag(positionX, positionY);\n  };\n\n  public onMouseUp = () => {\n    const {\n      shapes,\n      setAnnotationState,\n      selectedId,\n      props: { onAnnotationUpdate }\n    } = this.context;\n    setAnnotationState(new DefaultAnnotationState(this.context));\n    if (onAnnotationUpdate) {\n      const currentShape = shapes.find(\n        el => el.getAnnotationData().id === selectedId\n      );\n      onAnnotationUpdate(currentShape!.getAnnotationData());\n    }\n  };\n\n  public onMouseLeave = () => this.onMouseUp();\n}\n","import { ReactPictureAnnotation } from \"index\";\nimport { IAnnotationState } from \"./AnnotationState\";\nimport { DefaultAnnotationState } from \"./DefaultAnnotationState\";\n\nexport default class TransformationState implements IAnnotationState {\n  private context: ReactPictureAnnotation;\n  constructor(context: ReactPictureAnnotation) {\n    this.context = context;\n  }\n  public onMouseDown = () => undefined;\n  public onMouseMove = (positionX: number, positionY: number) => {\n    const { currentTransformer } = this.context;\n    if (currentTransformer) {\n      currentTransformer.onTransformation(positionX, positionY);\n    }\n  };\n\n  public onMouseUp = () => {\n    const { setAnnotationState } = this.context;\n    setAnnotationState(new DefaultAnnotationState(this.context));\n  };\n\n  public onMouseLeave = () => this.onMouseUp();\n}\n","import ReactPictureAnnotation from \"../ReactPictureAnnotation\";\nimport { RectShape } from \"../Shape\";\nimport Transformer from \"../Transformer\";\nimport randomId from \"../utils/randomId\";\nimport { IAnnotationState } from \"./AnnotationState\";\nimport CreatingAnnotationState from \"./CreatingAnnotationState\";\nimport DraggingAnnotationState from \"./DraggingAnnotationState\";\nimport TransformationState from \"./TransfromationState\";\n\nexport class DefaultAnnotationState implements IAnnotationState {\n  private context: ReactPictureAnnotation;\n  constructor(context: ReactPictureAnnotation) {\n    this.context = context;\n  }\n  public onMouseMove = () => undefined;\n  public onMouseUp = () => {\n    this.context.selectedId = null;\n    this.context.onShapeChange();\n  };\n\n  public onMouseLeave = () => undefined;\n\n  public onMouseDown = (positionX: number, positionY: number) => {\n    const {\n      shapes,\n      currentTransformer,\n      onShapeChange,\n      setAnnotationState: setState,\n      props: { editable }\n    } = this.context;\n\n    if (\n      currentTransformer &&\n      currentTransformer.checkBoundary(positionX, positionY)\n    ) {\n      currentTransformer.startTransformation(positionX, positionY);\n      setState(new TransformationState(this.context));\n      return;\n    }\n\n    for (let i = shapes.length - 1; i >= 0; i--) {\n      if (shapes[i].checkBoundary(positionX, positionY)) {\n        this.context.selectedId = shapes[i].getAnnotationData().id;\n        this.context.currentTransformer = new Transformer(shapes[i], editable);\n        const [selectedShape] = shapes.splice(i, 1);\n        shapes.push(selectedShape);\n        selectedShape.onDragStart(positionX, positionY);\n        onShapeChange();\n        setState(new DraggingAnnotationState(this.context));\n        return;\n      }\n    }\n    if (editable) {\n      const newShapeId = randomId();\n      this.context.shapes.push(\n        new RectShape(\n          {\n            id: newShapeId,\n            mark: {\n              x: positionX,\n              y: positionY,\n              width: 0,\n              height: 0,\n              type: \"RECT\"\n            }\n          },\n          onShapeChange\n        )\n      );\n\n      this.context.pendingShapeId = newShapeId;\n\n      setState(new CreatingAnnotationState(this.context));\n    }\n  };\n}\n","import React from \"react\";\n\nexport default () => {\n  return (\n    <svg\n      className=\"rp-delete\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n      viewBox=\"0 0 24 24\"\n    >\n      <g data-name=\"Layer 2\">\n        <g data-name=\"trash-2\">\n          <rect width=\"24\" height=\"24\" opacity=\"0\" />\n          <path d=\"M21 6h-5V4.33A2.42 2.42 0 0 0 13.5 2h-3A2.42 2.42 0 0 0 8 4.33V6H3a1 1 0 0 0 0 2h1v11a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V8h1a1 1 0 0 0 0-2zM10 16a1 1 0 0 1-2 0v-4a1 1 0 0 1 2 0zm0-11.67c0-.16.21-.33.5-.33h3c.29 0 .5.17.5.33V6h-4zM16 16a1 1 0 0 1-2 0v-4a1 1 0 0 1 2 0z\" />\n        </g>\n      </g>\n    </svg>\n  );\n};\n","import React from \"react\";\nimport { IAnnotation } from \"./Annotation\";\nimport DeleteButton from \"./DeleteButton\";\n\nexport interface IDefaultInputSection {\n  editable: boolean;\n  annotation: IAnnotation;\n  onChange: (value: string) => void;\n  onDelete: () => void;\n}\n\nexport default ({\n  editable,\n  annotation,\n  onChange,\n  onDelete\n}: IDefaultInputSection) => {\n  return (\n    <div className=\"rp-default-input-section\">\n      <input\n        className=\"rp-default-input-section_input\"\n        placeholder=\"INPUT TAG HERE\"\n        value={annotation.comment}\n        disabled={!editable}\n        onChange={e => onChange(e.target.value)}\n      />\n      {editable && (\n        <a\n          className=\"rp-default-input-section_delete\"\n          onClick={() => onDelete()}\n        >\n          <DeleteButton />\n        </a>\n      )}\n    </div>\n  );\n};\n","import React, { MouseEventHandler, TouchEventHandler } from \"react\";\nimport { IAnnotation } from \"./Annotation\";\nimport { IAnnotationState } from \"./annotation/AnnotationState\";\nimport { DefaultAnnotationState } from \"./annotation/DefaultAnnotationState\";\nimport DefaultInputSection from \"./DefaultInputSection\";\nimport { IShape, IShapeBase, RectShape, shapeStyle } from \"./Shape\";\nimport Transformer, { ITransformer } from \"./Transformer\";\n\ninterface IReactPictureAnnotationProps {\n  annotationData?: IAnnotation[];\n  selectedId?: string | null;\n  onChange?: (annotationData: IAnnotation[]) => void;\n  onSelect: (id: string | null) => void;\n  width: number;\n  height: number;\n  image: string;\n  editable: boolean;\n  drawLabel: boolean;\n  renderItemPreview: (\n    editable: boolean,\n    annotation: IAnnotation,\n    onChange: (value: string) => void,\n    onDelete: () => void\n  ) => React.ReactElement;\n  onAnnotationUpdate?: (annotation: IAnnotation) => void;\n  onAnnotationCreate?: (annotation: IAnnotation) => void;\n  onAnnotationDelete?: (annotation: IAnnotation) => void;\n}\n\ninterface IStageState {\n  scale: number;\n  originX: number;\n  originY: number;\n}\n\nconst defaultState: IStageState = {\n  scale: 1,\n  originX: 0,\n  originY: 0\n};\n\nexport default class ReactPictureAnnotation extends React.Component<\n  IReactPictureAnnotationProps\n> {\n  set selectedId(value: string | null) {\n    const { onSelect } = this.props;\n    this.selectedIdTrueValue = value;\n    onSelect(value);\n  }\n\n  get selectedId() {\n    return this.selectedIdTrueValue;\n  }\n\n  get selectedItem() {\n    if (!this.props.annotationData) {\n      return;\n    }\n    return this.props.annotationData.find(\n      el => el.id === this.selectedIdTrueValue\n    );\n  }\n  public static defaultProps = {\n    renderItemPreview: (\n      editable: boolean,\n      annotation: IAnnotation,\n      onChange: (value: string) => void,\n      onDelete: () => void\n    ) => (\n      <DefaultInputSection\n        editable={editable}\n        annotation={annotation}\n        onChange={onChange}\n        onDelete={onDelete}\n      />\n    ),\n    editable: false,\n    drawLabel: true\n  };\n\n  public shapes: IShape[] = [];\n  public currentTransformer: ITransformer;\n  public pendingShapeId: string | null = null;\n\n  public state = {\n    inputPosition: {\n      left: 0,\n      top: 0\n    },\n    showInput: false\n  };\n  private currentAnnotationData: IAnnotation[] = [];\n  private selectedIdTrueValue: string | null;\n  private canvasRef = React.createRef<HTMLCanvasElement>();\n  private canvas2D?: CanvasRenderingContext2D | null;\n  private imageCanvasRef = React.createRef<HTMLCanvasElement>();\n  private imageCanvas2D?: CanvasRenderingContext2D | null;\n  private currentImageElement?: HTMLImageElement;\n  private currentAnnotationState: IAnnotationState = new DefaultAnnotationState(\n    this\n  );\n  private scaleState = defaultState;\n  private startDrag?: {\n    x: number;\n    y: number;\n    originX: number;\n    originY: number;\n  } = undefined;\n  private lastPinchLength?: number;\n\n  public componentDidMount = () => {\n    const currentCanvas = this.canvasRef.current;\n    const currentImageCanvas = this.imageCanvasRef.current;\n    if (currentCanvas && currentImageCanvas) {\n      this.setCanvasDPI();\n\n      this.canvas2D = currentCanvas.getContext(\"2d\");\n      this.imageCanvas2D = currentImageCanvas.getContext(\"2d\");\n      this.onImageChange();\n    }\n\n    this.syncAnnotationData();\n    this.syncSelectedId();\n  };\n\n  public componentDidUpdate = (preProps: IReactPictureAnnotationProps) => {\n    const { width, height, image } = this.props;\n    if (preProps.width !== width || preProps.height !== height) {\n      this.setCanvasDPI();\n      this.onShapeChange();\n      this.onImageChange();\n    }\n    if (preProps.image !== image) {\n      this.cleanImage();\n      if (this.currentImageElement) {\n        this.currentImageElement.src = image;\n      } else {\n        this.onImageChange();\n      }\n    }\n\n    this.syncAnnotationData();\n    this.syncSelectedId();\n  };\n\n  public calculateMousePosition = (positionX: number, positionY: number) => {\n    const { originX, originY, scale } = this.scaleState;\n    return {\n      positionX: (positionX - originX) / scale,\n      positionY: (positionY - originY) / scale\n    };\n  };\n\n  public calculateShapePosition = (shapeData: IShapeBase): IShapeBase => {\n    const { originX, originY, scale } = this.scaleState;\n    const { x, y, width, height } = shapeData;\n    return {\n      x: x * scale + originX,\n      y: y * scale + originY,\n      width: width * scale,\n      height: height * scale\n    };\n  };\n\n  public render() {\n    const { width, height, renderItemPreview, editable } = this.props;\n    const { showInput, inputPosition } = this.state;\n    return (\n      <div className=\"rp-stage\">\n        <canvas\n          style={{ width, height }}\n          className=\"rp-image\"\n          ref={this.imageCanvasRef}\n          width={width * 2}\n          height={height * 2}\n        />\n        <canvas\n          className=\"rp-shapes\"\n          style={{ width, height }}\n          ref={this.canvasRef}\n          width={width * 2}\n          height={height * 2}\n          onMouseDown={this.onMouseDown}\n          onMouseMove={this.onMouseMove}\n          onMouseUp={this.onMouseUp}\n          onMouseLeave={this.onMouseLeave}\n          onTouchStart={this.onTouchStart}\n          onTouchEnd={this.onTouchEnd}\n          onTouchMove={this.onTouchMove}\n          onWheel={this.onWheel}\n        />\n        {showInput && this.selectedItem && (\n          <div className=\"rp-selected-input\" style={inputPosition}>\n            {renderItemPreview(\n              editable,\n              this.selectedItem,\n              this.onInputCommentChange,\n              this.onDelete\n            )}\n          </div>\n        )}\n      </div>\n    );\n  }\n\n  public setAnnotationState = (annotationState: IAnnotationState) => {\n    this.currentAnnotationState = annotationState;\n  };\n\n  public onShapeChange = () => {\n    if (this.canvas2D && this.canvasRef.current) {\n      this.canvas2D.clearRect(\n        0,\n        0,\n        this.canvasRef.current.width,\n        this.canvasRef.current.height\n      );\n\n      let hasSelectedItem = false;\n\n      for (const item of this.shapes) {\n        const isSelected = item.getAnnotationData().id === this.selectedId;\n        const { x, y, height } = item.paint(\n          this.canvas2D,\n          this.calculateShapePosition,\n          isSelected,\n          this.props.drawLabel\n        );\n\n        if (isSelected) {\n          if (\n            !this.currentTransformer ||\n            this.currentTransformer.id !== item.getAnnotationData().id\n          ) {\n            this.currentTransformer = new Transformer(\n              item,\n              this.props.editable\n            );\n          }\n\n          hasSelectedItem = true;\n\n          this.currentTransformer.paint(\n            this.canvas2D,\n            this.calculateShapePosition\n          );\n\n          this.setState({\n            showInput: true,\n            inputPosition: {\n              left: x,\n              top: y + height + shapeStyle.margin\n            }\n          });\n        }\n      }\n\n      if (!hasSelectedItem) {\n        this.setState({\n          showInput: false,\n          inputComment: \"\"\n        });\n      }\n    }\n\n    this.currentAnnotationData = this.shapes.map(item =>\n      item.getAnnotationData()\n    );\n    const { onChange } = this.props;\n    if (onChange) {\n      onChange(this.currentAnnotationData);\n    }\n  };\n\n  public onDelete = (id = this.selectedId) => {\n    const { onAnnotationDelete, editable } = this.props;\n    if (editable) {\n      const deleteTarget = this.shapes.findIndex(\n        shape => shape.getAnnotationData().id === id\n      );\n      if (deleteTarget >= 0) {\n        this.shapes.splice(deleteTarget, 1);\n        this.onShapeChange();\n        const annotation = this.shapes.find(\n          shape => shape.getAnnotationData().id === id\n        );\n        if (onAnnotationDelete && annotation) {\n          onAnnotationDelete(annotation.getAnnotationData());\n        }\n      }\n    }\n  };\n\n  private syncAnnotationData = () => {\n    const { annotationData } = this.props;\n    if (annotationData) {\n      const refreshShapesWithAnnotationData = () => {\n        const nextShapes = annotationData.map(\n          eachAnnotationData =>\n            new RectShape(eachAnnotationData, this.onShapeChange)\n        );\n        this.shapes = nextShapes;\n        if (\n          !nextShapes.find(el => el.getAnnotationData().id === this.selectedId)\n        ) {\n          this.selectedId = null;\n        }\n        this.onShapeChange();\n      };\n\n      if (annotationData.length !== this.shapes.length) {\n        refreshShapesWithAnnotationData();\n      } else {\n        for (const annotationDataItem of annotationData) {\n          const targetShape = this.shapes.find(\n            item => item.getAnnotationData().id === annotationDataItem.id\n          );\n          if (targetShape && targetShape.equal(annotationDataItem)) {\n            continue;\n          } else {\n            refreshShapesWithAnnotationData();\n            break;\n          }\n        }\n      }\n    }\n  };\n\n  private syncSelectedId = () => {\n    const { selectedId } = this.props;\n\n    if (selectedId && selectedId !== this.selectedId) {\n      this.selectedId = selectedId;\n      this.onShapeChange();\n    }\n  };\n\n  private setCanvasDPI = () => {\n    const currentCanvas = this.canvasRef.current;\n    const currentImageCanvas = this.imageCanvasRef.current;\n    if (currentCanvas && currentImageCanvas) {\n      const currentCanvas2D = currentCanvas.getContext(\"2d\");\n      const currentImageCanvas2D = currentImageCanvas.getContext(\"2d\");\n      if (currentCanvas2D && currentImageCanvas2D) {\n        currentCanvas2D.scale(2, 2);\n        currentImageCanvas2D.scale(2, 2);\n      }\n    }\n  };\n\n  private onInputCommentChange = (comment: string) => {\n    if (this.props.editable) {\n      const selectedShapeIndex = this.shapes.findIndex(\n        item => item.getAnnotationData().id === this.selectedId\n      );\n      this.shapes[selectedShapeIndex].getAnnotationData().comment = comment;\n      this.onShapeChange();\n    }\n  };\n\n  private cleanImage = () => {\n    if (this.imageCanvas2D && this.imageCanvasRef.current) {\n      this.imageCanvas2D.clearRect(\n        0,\n        0,\n        this.imageCanvasRef.current.width,\n        this.imageCanvasRef.current.height\n      );\n    }\n  };\n\n  private onImageChange = () => {\n    this.cleanImage();\n    if (this.imageCanvas2D && this.imageCanvasRef.current) {\n      if (this.currentImageElement) {\n        const { originX, originY, scale } = this.scaleState;\n        this.imageCanvas2D.drawImage(\n          this.currentImageElement,\n          originX,\n          originY,\n          this.currentImageElement.width * scale,\n          this.currentImageElement.height * scale\n        );\n      } else {\n        const nextImageNode = document.createElement(\"img\");\n        nextImageNode.addEventListener(\"load\", () => {\n          this.currentImageElement = nextImageNode;\n          const { width, height } = nextImageNode;\n          const imageNodeRatio = height / width;\n          const { width: canvasWidth, height: canvasHeight } = this.props;\n          const canvasNodeRatio = canvasHeight / canvasWidth;\n          if (!isNaN(imageNodeRatio) && !isNaN(canvasNodeRatio)) {\n            if (imageNodeRatio < canvasNodeRatio) {\n              const scale = canvasWidth / width;\n              this.scaleState = {\n                originX: 0,\n                originY: (canvasHeight - scale * height) / 2,\n                scale\n              };\n            } else {\n              const scale = canvasHeight / height;\n              this.scaleState = {\n                originX: (canvasWidth - scale * width) / 2,\n                originY: 0,\n                scale\n              };\n            }\n          }\n          this.onImageChange();\n          this.onShapeChange();\n        });\n        nextImageNode.alt = \"\";\n        nextImageNode.src = this.props.image;\n      }\n    }\n  };\n\n  private onMouseDown: MouseEventHandler<HTMLCanvasElement> = event => {\n    const { editable } = this.props;\n    const { offsetX, offsetY } = event.nativeEvent;\n    const { positionX, positionY } = this.calculateMousePosition(\n      offsetX,\n      offsetY\n    );\n    this.currentAnnotationState.onMouseDown(positionX, positionY);\n    if (!editable) {\n      const { originX, originY } = this.scaleState;\n      this.startDrag = { x: offsetX, y: offsetY, originX, originY };\n    }\n  };\n\n  private onMouseMove: MouseEventHandler<HTMLCanvasElement> = event => {\n    const { editable } = this.props;\n    const { offsetX, offsetY } = event.nativeEvent;\n    const { positionX, positionY } = this.calculateMousePosition(\n      offsetX,\n      offsetY\n    );\n    if (editable) {\n      this.currentAnnotationState.onMouseMove(positionX, positionY);\n    } else if (this.startDrag) {\n      this.scaleState.originX =\n        this.startDrag.originX + (offsetX - this.startDrag.x);\n      this.scaleState.originY =\n        this.startDrag.originY + (offsetY - this.startDrag.y);\n\n      this.setState({ imageScale: this.scaleState });\n\n      requestAnimationFrame(() => {\n        this.onShapeChange();\n        this.onImageChange();\n      });\n    }\n  };\n\n  private onMouseUp: MouseEventHandler<HTMLCanvasElement> = () => {\n    this.currentAnnotationState.onMouseUp();\n    this.startDrag = undefined;\n  };\n\n  private onTouchStart: TouchEventHandler<HTMLCanvasElement> = event => {\n    const { editable } = this.props;\n    const { clientX, clientY } = event.touches[0];\n    const { positionX, positionY } = this.calculateMousePosition(\n      clientX,\n      clientY\n    );\n\n    this.currentAnnotationState.onMouseDown(positionX, positionY);\n    if (!editable) {\n      const { touches } = event;\n      if (touches.length === 2) {\n        this.lastPinchLength = getPinchLength(touches);\n      } else if (touches.length === 1) {\n        this.lastPinchLength = undefined;\n        const { originX, originY } = this.scaleState;\n        this.startDrag = { x: clientX, y: clientY, originX, originY };\n      }\n    }\n\n    // suppress viewport scaling on iOS\n    tryCancelEvent(event);\n  };\n\n  private onTouchMove: TouchEventHandler<HTMLCanvasElement> = event => {\n    const { editable } = this.props;\n    const { clientX, clientY } = event.touches[0];\n    const { positionX, positionY } = this.calculateMousePosition(\n      clientX,\n      clientY\n    );\n    if (editable) {\n      this.currentAnnotationState.onMouseMove(positionX, positionY);\n    } else {\n      const { touches } = event;\n      if (touches.length === 2) {\n        this.handlePinchChange(touches);\n      } else if (touches.length === 1) {\n        if (this.startDrag) {\n          this.scaleState.originX =\n            this.startDrag.originX + (clientX - this.startDrag.x);\n          this.scaleState.originY =\n            this.startDrag.originY + (clientY - this.startDrag.y);\n\n          this.setState({ imageScale: this.scaleState });\n\n          requestAnimationFrame(() => {\n            this.onShapeChange();\n            this.onImageChange();\n          });\n        }\n      }\n    }\n\n    // suppress viewport scaling on iOS\n    tryCancelEvent(event);\n  };\n\n  private onTouchEnd: TouchEventHandler<HTMLCanvasElement> = () => {\n    this.currentAnnotationState.onMouseUp();\n    this.startDrag = undefined;\n  };\n\n  private handlePinchChange = (touches: React.TouchList) => {\n    const length = getPinchLength(touches);\n    const midpoint = getPinchMidpoint(touches);\n    let scale = this.lastPinchLength\n      ? (this.scaleState.scale * length) / this.lastPinchLength // sometimes we get a touchchange before a touchstart when pinching\n      : this.scaleState.scale;\n\n    if (scale > 10) {\n      scale = 10;\n    }\n    if (scale < 0.1) {\n      scale = 0.1;\n    }\n\n    const { originX, originY } = this.scaleState;\n\n    this.scaleState.originX =\n      midpoint.x - ((midpoint.x - originX) / this.scaleState.scale) * scale;\n    this.scaleState.originY =\n      midpoint.y - ((midpoint.y - originY) / this.scaleState.scale) * scale;\n    this.scaleState.scale = scale;\n\n    this.setState({ imageScale: this.scaleState });\n\n    requestAnimationFrame(() => {\n      this.onShapeChange();\n      this.onImageChange();\n    });\n  };\n\n  private onMouseLeave: MouseEventHandler<HTMLCanvasElement> = () => {\n    this.currentAnnotationState.onMouseLeave();\n  };\n\n  private onWheel = (event: React.WheelEvent<HTMLCanvasElement>) => {\n    // https://stackoverflow.com/a/31133823/9071503\n    const { clientHeight, scrollTop, scrollHeight } = event.currentTarget;\n    if (clientHeight + scrollTop + event.deltaY > scrollHeight) {\n      // event.preventDefault();\n      event.currentTarget.scrollTop = scrollHeight;\n    } else if (scrollTop + event.deltaY < 0) {\n      // event.preventDefault();\n      event.currentTarget.scrollTop = 0;\n    }\n\n    const { scale: preScale } = this.scaleState;\n    this.scaleState.scale += event.deltaY * 0.005;\n    if (this.scaleState.scale > 10) {\n      this.scaleState.scale = 10;\n    }\n    if (this.scaleState.scale < 0.1) {\n      this.scaleState.scale = 0.1;\n    }\n\n    const { originX, originY, scale } = this.scaleState;\n    const { offsetX, offsetY } = event.nativeEvent;\n    this.scaleState.originX =\n      offsetX - ((offsetX - originX) / preScale) * scale;\n    this.scaleState.originY =\n      offsetY - ((offsetY - originY) / preScale) * scale;\n\n    this.setState({ imageScale: this.scaleState });\n\n    requestAnimationFrame(() => {\n      this.onShapeChange();\n      this.onImageChange();\n    });\n  };\n}\n\nexport const getPinchMidpoint = (touches: React.TouchList) => {\n  const touch1 = touches[0];\n  const touch2 = touches[1];\n  return {\n    x: (touch1.clientX + touch2.clientX) / 2,\n    y: (touch1.clientY + touch2.clientY) / 2\n  };\n};\n\nexport const getPinchLength = (touches: React.TouchList) => {\n  const touch1 = touches[0];\n  const touch2 = touches[1];\n  return Math.sqrt(\n    Math.pow(touch1.clientY - touch2.clientY, 2) +\n      Math.pow(touch1.clientX - touch2.clientX, 2)\n  );\n};\n\nexport const tryCancelEvent = (event: React.TouchEvent) => {\n  if (event.cancelable === false) {\n    return false;\n  }\n\n  event.preventDefault();\n  return true;\n};\n"],"names":["shapeStyle","padding","margin","fontSize","fontColor","fontBackground","fontFamily","shapeBackground","shapeStrokeStyle","shapeShadowStyle","RectShape","data","onChange","positionX","positionY","annotationData","mark","x","y","dragStartOffset","offsetX","offsetY","onChangeCallBack","width","height","canvas2D","calculateTruePosition","selected","drawLabel","save","shadowBlur","shadowColor","strokeStyle","strokeColor","lineWidth","strokeRect","restore","fillStyle","backgroundColor","fillRect","comment","font","metrics","measureText","textBaseline","fillText","id","NODE_WIDTH","Transformer","shape","editable","currentCenterIndex","getCenterIndexByCursor","currentNodeCenterIndex","currentCentersTable","getAllCentersTable","adjust","allCentersTable","item","findIndex","checkEachRectBoundary","rectCenterX","rectCenterY","Math","abs","getAnnotationData","adjustMark","_","len","chars","maxPos","length","i","charAt","floor","random","CreatingAnnotationState","context","undefined","shapes","onShapeChange","currentShape","find","el","pendingShapeId","setAnnotationState","onDelete","onAnnotationCreate","props","selectedId","DefaultAnnotationState","onMouseUp","DraggingAnnotationState","onDrag","onAnnotationUpdate","TransformationState","currentTransformer","onTransformation","setState","checkBoundary","startTransformation","splice","selectedShape","push","onDragStart","newShapeId","randomId","type","annotation","e","target","value","defaultState","scale","originX","originY","ReactPictureAnnotation","inputPosition","left","top","showInput","React","createRef","currentCanvas","canvasRef","current","currentImageCanvas","imageCanvasRef","setCanvasDPI","getContext","imageCanvas2D","onImageChange","syncAnnotationData","syncSelectedId","preProps","image","cleanImage","currentImageElement","src","scaleState","shapeData","annotationState","currentAnnotationState","clearRect","hasSelectedItem","isSelected","paint","calculateShapePosition","inputComment","currentAnnotationData","map","onAnnotationDelete","deleteTarget","refreshShapesWithAnnotationData","nextShapes","eachAnnotationData","annotationDataItem","targetShape","equal","currentCanvas2D","currentImageCanvas2D","selectedShapeIndex","drawImage","nextImageNode","document","createElement","addEventListener","imageNodeRatio","canvasWidth","canvasHeight","canvasNodeRatio","isNaN","alt","event","nativeEvent","calculateMousePosition","onMouseDown","startDrag","onMouseMove","imageScale","requestAnimationFrame","touches","clientX","clientY","lastPinchLength","getPinchLength","tryCancelEvent","handlePinchChange","midpoint","getPinchMidpoint","onMouseLeave","currentTarget","clientHeight","scrollTop","scrollHeight","deltaY","preScale","renderItemPreview","state","onTouchStart","onTouchEnd","onTouchMove","onWheel","selectedItem","onInputCommentChange","onSelect","selectedIdTrueValue","Component","touch1","touch2","sqrt","pow","cancelable","preventDefault"],"mappings":"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"}